<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Flocking</title>
          <script src="bower_components/flocking/dist/flocking-all.js"></script>
          <script src="../osciloscil.js"></script>
    </head>
    <body>

        <div id="ooforms">

        </div>

        <script>
            var ooindex = 0;
            var mywaves = [];
            var flockwaves = Object.keys(flock.tableGenerators); // returns array of keys in tableGeneraotrs

            var addSelector = function(){

                var mystring = '<select id=\"wave' + ooindex + '\">';
                for (var i = 0; i < flockwaves.length; i++){
                    mystring += '<option>' + flockwaves[i] + '</option>'; 
                }
                mystring += '</select>';
                $('#ooforms').append(mystring);
                    
               // using a closure to maintain index of selector after instantiation 
                $('#wave'+ooindex).on('change', function(i){
                    return function(e){
                        var myindex = i;
                        if( $(this).is(":last-child") ){
                            mywaves.push( $(this).val() );
                            addSelector();
                        }
                        else{
                            mywaves[myindex] = $(this).val(); 
                        }
                        myosc.setWaves(mywaves);
                        console.log( mywaves );
                    }
                }(ooindex));

                ooindex++;
            };

            addSelector();
        </script>

        <script>
            myosc = osciloscil();
            myosc.setfreq(400);
            myosc.setWaves(['square','sin']);
            //myosc.synth.play();
        </script>

    </body>
</html>
